# 자동매매 시스템 개발 계획 (애자일)

> **핵심 원칙**: 빠른 사이클로 "지표 구현 → 전략 조합 → 백테스팅 → 학습" 반복!

---

## 🚀 Iteration 1: MVP - 첫 수익 확인 (1-2주)

**목표**: 가장 단순한 전략으로 백테스팅 돌려보기
**도구**: backtesting.py 📦 (빠른 검증)

### 지표 구현 (TDD)
- [x] SMA (Simple Moving Average)
- [x] EMA (Exponential Moving Average)

### 백테스팅 엔진 설정
- [x] backtesting.py 설치 (`uv add backtesting`)
- [x] 과거 데이터 로드 (KIS API에서 일봉 가져오기)
- [x] 우리 지표를 backtesting.py에 연결
- [x] Strategy 클래스 작성

### 첫 전략: 이평 때리기 (EMA Pullback)
- [x] 진입: EMA60 위에서만 매수, EMA(60/112/224) 눌림목 터치 시
- [x] 청산: EMA60 이탈 시 전량 매도
- [x] 삼성전자 2년치 데이터로 백테스팅

### 회고
- [ ] 수익 났나? 손실 났나?
- [ ] 어떤 구간에서 잘 됐나? 안 됐나?
- [ ] 다음 Iteration에서 뭘 개선할까?

---

## 🎯 Iteration 2: 필터 추가 - 승률 높이기 (1주)

**목표**: RSI로 과매수/과매도 필터링 → 승률 개선
**도구**: backtesting.py 📦 (계속 사용)

### 지표 구현 (TDD)
- [ ] RSI (Relative Strength Index)

### 전략: MA + RSI 조합
- [ ] 진입: 골든 크로스 **AND** RSI < 70 (과매수 아닐 때만)
- [ ] 청산: 데드 크로스 **OR** RSI > 70 (과매수 시 빠른 청산)

### 백테스팅 비교
- [ ] Iteration 1 전략 vs Iteration 2 전략
- [ ] 수익률, 승률, 거래 횟수 비교
- [ ] 개선됐나?

### 회고
- [ ] RSI 필터가 도움 됐나?
- [ ] 어떤 파라미터가 좋았나? (RSI 기준: 70? 80?)
- [ ] 다음엔 뭘 시도해볼까?

---

## 📈 Iteration 3: 변동성 고려 (1주)

**목표**: 볼린저 밴드로 변동성 파악 → 진입/청산 타이밍 개선
**도구**: backtesting.py 📦 (계속 사용)

### 지표 구현 (TDD)
- [ ] Bollinger Bands (볼린저 밴드)

### 전략: 볼린저 밴드 돌파 + MA
- [ ] 진입: 가격이 하단 밴드 터치 **AND** 골든 크로스
- [ ] 청산: 가격이 상단 밴드 터치 **OR** 데드 크로스

### 백테스팅 비교
- [ ] Iteration 2 vs Iteration 3
- [ ] 변동성 큰 종목 vs 작은 종목에서 각각 테스트

### 회고
- [ ] 볼린저 밴드가 효과 있었나?
- [ ] 어떤 종목에서 잘 됐나?
- [ ] 지금까지 중 최고 전략은?

---

## 🛡️ Iteration 4: 리스크 관리 (1주)

**목표**: 손절/익절로 MDD(최대 낙폭) 줄이기
**도구**: backtesting.py 📦 or 통합 엔진 🔧 (선택)

### 리스크 관리 구현 (TDD)
- [ ] 고정 손절선 (-5%)
- [ ] 고정 익절선 (+10%)
- [ ] Trailing Stop (이동 손절)

### 백테스팅 개선
- [ ] MDD (Maximum Drawdown) 계산
- [ ] 샤프 비율 (Sharpe Ratio) 계산
- [ ] 월별 수익률 계산

### 전략: 최고 전략 + 리스크 관리
- [ ] Iteration 1~3 중 최고 전략 선택
- [ ] 손절/익절 로직 추가
- [ ] 백테스팅 비교 (리스크 관리 전 vs 후)

### 회고
- [ ] MDD 줄었나?
- [ ] 수익률은 유지되나?
- [ ] 손절/익절 비율 조정 필요한가?

---

## 🔥 Iteration 5: 복잡한 전략 실험 (1-2주)

**목표**: MACD 같은 복합 지표로 더 정교한 신호

### 지표 구현 (TDD)
- [ ] MACD (Moving Average Convergence Divergence)
- [ ] ATR (Average True Range) - 변동성 기반 손절

### 전략: MACD + ATR
- [ ] 진입: MACD 골든 크로스
- [ ] 청산: MACD 데드 크로스
- [ ] 손절: ATR 기반 동적 손절선 (변동성에 따라 조정)

### 파라미터 최적화
- [ ] Grid Search로 최적 파라미터 찾기
  - [ ] MACD (12, 26, 9) vs (5, 35, 5) 등
  - [ ] ATR 배수 (1x, 2x, 3x)
- [ ] Train/Test Split (과적합 방지)

### 회고
- [ ] 지금까지 중 최종 전략 결정
- [ ] 실전 투자 준비됐나?

---

## 🎬 Iteration 6: 실전 준비 (2주)

**목표**: 모의투자로 실전 검증
**도구**: 통합 엔진 🔧 (백테스팅 + 실전 코드 통합)

### 통합 자동매매 엔진 구현
- [ ] TradingEngine 클래스 (mode='backtest' or 'live')
- [ ] 백테스팅 모드: 과거 데이터로 검증
- [ ] 실전 모드: 실시간 시세 수신 (WebSocket)
- [ ] 실시간 지표 계산 (우리가 만든 지표 사용)
- [ ] 자동 주문 실행 (모의투자 계좌)

### 모의투자 운영
- [ ] 최소 2주 모의투자 실행
- [ ] 백테스팅 vs 실전 결과 비교
- [ ] 슬리피지/수수료 영향 확인

### 모니터링 & 알림
- [ ] 텔레그램/슬랙 알림
  - [ ] 매매 체결
  - [ ] 손익률 업데이트
  - [ ] 에러 발생

### 회고
- [ ] 백테스팅과 실전 차이는?
- [ ] 예상치 못한 이슈는?
- [ ] 실전 투자 Go/No-Go 결정

---

## 📊 백로그 (나중에 필요하면)

### 추가 지표
- [ ] Stochastic Oscillator
- [ ] CCI (Commodity Channel Index)
- [ ] OBV (On-Balance Volume)
- [ ] ADX (Average Directional Index)

### 고급 기능
- [ ] 다중 종목 포트폴리오
- [ ] 분산 투자 규칙
- [ ] Walk-Forward Testing
- [ ] 머신러닝 기반 예측

---

## 🎯 현재 상태

**Current Iteration**: Iteration 1 진행 중
- [x] SMA 구현 완료 (TDD)
- [x] EMA 구현 완료 (TDD)
- [x] 백테스팅 엔진 설정 완료
- [ ] 다음: 첫 전략 실행 및 백테스팅 ← **여기부터 시작!**

---

## 💡 개발 원칙

1. **TDD는 지표에만**: 수학 계산은 정확해야 하니까
2. **전략은 백테스팅으로**: 정답이 없으니 실험으로 검증
3. **작고 빠르게**: 각 Iteration은 1-2주 이내
4. **배우고 개선**: 매 Iteration 후 회고 필수
5. **실전 전 검증**: 모의투자 없이 실전 투자 금지!
6. **하이브리드 접근**:
   - Iteration 1-3: backtesting.py로 빠르게 전략 검증
   - Iteration 4+: 필요 시 통합 엔진으로 전환 (선택)
   - Iteration 6: 통합 엔진으로 실전 준비 (필수)