# 자동매매 시스템 개발 계획 (애자일)

> **핵심 원칙**: 빠른 사이클로 "지표 구현 → 전략 조합 → 백테스팅 → 학습" 반복!

---

## 🚀 Iteration 1: MVP - 첫 수익 확인 (1-2주)

**목표**: 가장 단순한 전략으로 백테스팅 돌려보기
**도구**: backtesting.py 📦 (빠른 검증)

### 지표 구현 (TDD)
- [x] SMA (Simple Moving Average)
- [x] EMA (Exponential Moving Average)
- [x] RSI (Relative Strength Index)

### 백테스팅 엔진 설정
- [x] backtesting.py 설치 (`uv add backtesting`)
- [x] 과거 데이터 로드 (KIS API에서 일봉 가져오기)
- [x] 우리 지표를 backtesting.py에 연결
- [x] Strategy 클래스 작성

### 새 전략: 코스닥피 레인 (4개 ETF 변동성 돌파 전략)

**투자 대상 (각 1/4 비중, 코스닥은 모멘텀 기반 비중 조절)**
- KODEX 코스닥150레버리지 (233740)
- KODEX 코스닥150선물인버스 (251340)
- KODEX 레버리지 (122630)
- KODEX 200선물인버스2X (252670)

**공통 조건**
- 매매당 슬리피지: 0.15% (수수료 + 세금)

#### 1. KODEX 코스닥150레버리지 (233740)
- [x] 매수 조건:
  - 기본 필터: (시가 > 전일 저가) OR (전일 종가 > 10일 이동평균)
  - K값 결정: 현재가 기준 60일선 위 = 0.3, 60일선 아래 = 0.4
  - 목표가 = 금일 시가 + (전일 고가 - 전일 저가) × K
  - 장중 목표가 상향 돌파시 매수
- [x] 매도 조건:
  - K값 결정: 현재가 기준 60일선 위 = 0.4, 60일선 아래 = 0.3
  - 목표가 = 금일 시가 - (전일 고가 - 전일 저가) × K
  - 장중 목표가 하향 돌파시 매도

#### 2. KODEX 코스닥150선물인버스 (251340)
- [ ] 매수 조건:
  - 기본 필터: 전일 종가 > 20일 이동평균
  - K값 = 0.4
  - 목표가 = 금일 시가 + (전일 고가 - 전일 저가) × 0.4
  - 장중 목표가 상향 돌파시 매수
- [ ] 매도 조건:
  - K값 = 0.4
  - 목표가 = 금일 시가 - (전일 고가 - 전일 저가) × 0.4
  - 장중 목표가 하향 돌파시 매도

#### 3. KODEX 레버리지 (122630)
- [ ] 매수 조건:
  - 전전일 저가 < 전일 저가
  - 20일 이동평균선 이격도 < 98 OR > 106
  - 전일 종가 기준 RSI < 80
  - 조건 만족시 장 시작 후 매수
- [ ] 매도 조건 (홀딩 조건):
  - (전전일 저가 < 전일 저가 OR 전일 거래량 < 최근 3일 평균 거래량) AND (20일 이격도 < 98 OR > 106) → 홀딩
  - 위 조건 불만족시 장 시작 후 매도

#### 4. KODEX 200선물인버스2X (252670)
- [ ] 매수 조건:
  - 전일 종가 > (3일선, 6일선, 19일선, 60일선)
  - 60일선 증가 중 (전전일 60일선 < 전일 60일선)
  - 정배열: 3일선 > 6일선 > 19일선
  - 전일 종가 기준 RSI < 70
  - 전전일 RSI < 전일 RSI
  - 전전일 거래량 < 전일 거래량
  - 전전일 저가 < 전일 저가
  - 조건 만족시 장 시작 후 매수
- [ ] 매도 조건:
  - IF 11일 이동평균선 이격도 > 105: 전일 종가 < 3일선 → 매도
  - IF 11일 이동평균선 이격도 ≤ 105: 전일 종가 < 6일선 AND 전일 종가 < 19일선 → 매도

#### 5. 코스닥 전략 비중 조절 (레버리지 & 인버스)
- [ ] 모멘텀 스코어 계산:
  - 모멘텀 스코어1 = 100일 평균 모멘텀 (10일마다) - 장기추세
  - 모멘텀 스코어2 = 20일간 등락률의 이동평균선 - 단기추세
- [ ] 비중 조절:
  - IF 레버리지의 스코어1, 스코어2 모두 > 인버스: 레버리지 × 1.3, 인버스 × 0.7
  - ELSE: 레버리지 × 0.7, 인버스 × 1.3
  

### 회고
- [ ] 수익 났나? 손실 났나?
- [ ] 어떤 구간에서 잘 됐나? 안 됐나?
- [ ] 다음 Iteration에서 뭘 개선할까?

---

## 🎯 현재 상태

**Current Iteration**: Iteration 1 진행 중
- [x] SMA 구현 완료 (TDD)
- [x] EMA 구현 완료 (TDD)
- [x] RSI 구현 완료 (TDD)
- [x] 백테스팅 엔진 설정 완료
- [ ] 다음: 코스닥피 레인 전략 구현 시작 ← **여기부터 시작!**

---

## 💡 개발 원칙

1. **TDD는 지표에만**: 수학 계산은 정확해야 하니까
2. **전략은 백테스팅으로**: 정답이 없으니 실험으로 검증